---
// src/pages/featured.astro
import Layout from '~/layouts/PageLayout.astro';
import BlogList from '~/components/blog/List.astro';
import Headline from '~/components/blog/Headline.astro';
import { fetchPosts } from '~/utils/blog';
import { getBlogPermalink } from '~/utils/permalinks';

export const prerender = true;

// Fetch only featured posts
const allPosts = await fetchPosts();
const featuredPosts = allPosts.filter((post) => post.featured === true);

const metadata = {
  title: 'Featured Posts',
  description:
    'Discover our most important and highlighted blog posts covering security, automation, and technology insights.',
  robots: {
    index: true,
    follow: true,
  },
  openGraph: {
    type: 'website',
  },
};
---

<Layout metadata={metadata}>
  <section class="px-6 sm:px-6 py-12 sm:py-16 lg:py-20 mx-auto max-w-4xl">
    <Headline
      subtitle="Our most important insights and in-depth analysis on cybersecurity, automation, and emerging technologies."
    >
      Featured Posts
    </Headline>

    {
      featuredPosts.length === 0 ? (
        <div class="text-center py-12">
          <div class="max-w-md mx-auto">
            <svg
              class="mx-auto h-12 w-12 text-gray-400 dark:text-slate-500"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">No Featured Posts</h3>
            <p class="mt-2 text-sm text-gray-500 dark:text-slate-400">
              We haven't featured any posts yet. Check back soon for highlighted content!
            </p>
            <div class="mt-6">
              <a
                href={getBlogPermalink()}
                class="inline-flex items-center text-sm font-medium text-gray-600 dark:text-slate-300 hover:text-primary dark:hover:text-blue-400 transition-colors duration-200"
              >
                Browse All Posts
                <svg class="ml-2 -mr-1 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </a>
            </div>
          </div>
        </div>
      ) : (
        <>
          <div class="mb-8">
            <p class="text-sm text-gray-600 dark:text-slate-400">
              Showing {featuredPosts.length} featured {featuredPosts.length === 1 ? 'post' : 'posts'}
            </p>
          </div>

          <BlogList posts={featuredPosts} />

          <div class="mt-12 text-center">
            <a
              href={getBlogPermalink()}
              class="inline-flex items-center text-sm font-medium text-gray-600 dark:text-slate-300 hover:text-primary dark:hover:text-blue-400 transition-colors duration-200"
            >
              Browse All Posts
              <svg class="ml-2 -mr-1 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          </div>
        </>
      )
    }
  </section>
</Layout>
